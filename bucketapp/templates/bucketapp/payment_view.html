<body>
<form method="post">
    {% csrf_token %}
    {{ payment_form.as_p }}
    <button type="submit" name={{ payment_name }}>Add Payment</button>
</form>

<!-- Display Repeated Payments -->
<table>
    <tr>
        <th>User</th>
        <th>Source</th>
        <th>Budgeted</th>
        <th>Spent</th>
        <!-- ... other fields ... -->
    </tr>
    {% for payment in payment_records %}
    <tr>
        <td>{{ payment.user }}</td>
        <td>{{ payment.source }}</td>
        <td>{{ payment.budgeted }}</td>
        <td>{{ payment.spent }}</td>
        <td>{{ payment.description }}</td>
        <td>{{ payment.date_received }}</td>

        <!-- ... other fields ... -->
        <td>
            <!-- Add Edit/Delete buttons here -->
        </td>
    </tr>
    {% endfor %}
</table>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        const categorySelect = document.getElementById('id_category');
        const newCategoryInput = document.createElement('input');
        newCategoryInput.type = 'text';
        newCategoryInput.id = 'new_category_name';
        newCategoryInput.style.display = 'none';
        categorySelect.parentNode.appendChild(newCategoryInput);

        categorySelect.addEventListener('change', function() {
            if (this.value === 'new') {
                newCategoryInput.style.display = '';
            } else {
                newCategoryInput.style.display = 'none';
            }
        });

        newCategoryInput.addEventListener('change', function() {
            fetch('/path/to/create_category_view/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ category_name: this.value }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const newOption = new Option(data.category_name, data.category_id, true, true);
                    categorySelect.add(newOption);
                    newCategoryInput.style.display = 'none';
                }
            });
        });
    });
</script>
</body>
<!-- Similar table for One-Time Payments -->

